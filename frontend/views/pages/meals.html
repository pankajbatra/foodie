<div ng-controller="mealsCtrl" ng-init="init()">
    <div class="space-seperator"></div>

    <div class="row">
        <div class="row" ng-controller="AlertsCtrl">
            <div class="col-xs-12" ng-repeat="(cat, msgs) in alerts | keys: ['meals']">
                <alert data-ng-repeat="alert in msgs" type="{{alert.type}}" close="closeAlert(cat, $index)"
                       ng-init="autoDismiss(cat, $index, 5000)">{{alert.msg}}
                </alert>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 no-r-padding">
            <form name="set_email_form">
                <div class="row no-margin">
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3 no-l-padding">
                        <button class="btn btn-default btn-primary" ng-click='createMeal=true'>Add New Meal</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="space-seperator"></div>
    <div class="row">
        <div class="col-md-12">
            <div ng-if="createMeal || editMeal" class="row customer-page-row">
                <div class="panel panel-warning">
                    <div class="panel-heading"><h3>Dish/Meal</h3>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-8">
                                <h4>{{meals.length ? '': "Let's create your first dish!"}}</h4>
                            </div>
                            <div ng-if="editMeal" class="col-md-2" style="float: right; text-align: center;padding-bottom: 5px;">
                                <h4>Status: {{meal.setStatus ? 'In Stock' : 'Out Of Stock'}}</h4>
                                <toggle-switch
                                        ng-model="meal.setStatus"
                                        on-label="In Stock"
                                        knob-label="Status"
                                        class="switch-success"
                                        ng-confirm-click="Are you sure you want to show this meal {{!meal.setStatus ? 'In Stock' : 'Out Of Stock'}}?"
                                        ng-change="changeStatus(meal)"
                                        off-label="Out Of Stock">
                                </toggle-switch>
                            </div>
                        </div>
                        <br>
                        <form ng-submit="saveMeal(meal)" name="detailsForm">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>Meal Name <em  class="fa fa-asterisk"></em></label>
                                        <input ng-disabled="!createMeal" type="text" class="form-control" minlength="3" maxlength="50" ng-model="meal.name" required>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>Description </label>
                                        <input ng-disabled="!createMeal" type="text" minlength="5" maxlength="200" class="form-control" ng-model="meal.description">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>Serves <em class="fa fa-asterisk"></em></label>
                                        <input ng-disabled="!createMeal" min="1" max="50" type="number" class="form-control" ng-model="meal.serves" required>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>Price <em  class="fa fa-asterisk"></em></label>
                                        <input class="form-control" ng-disabled="!createMeal" min="0.1" max="5000" type="number" name="myDecimal"
                                               ng-model="meal.price" step="0.01" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>course </label>
                                        <select ng-disabled="!createMeal" class="form-control" name="courseSelect" id="courseSelect" ng-model="meal.course">
                                            <option value="" selected >--Select meal course--</option>
                                            <option value="Appetizer">Appetizer</option>
                                            <option value="Breakfast">Breakfast</option>
                                            <option value="MainCourse">MainCourse</option>
                                            <option value="Desserts">Desserts</option>
                                            <option value="Salad">Salad</option>
                                            <option value="Soup">Soup</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>Spice Level</label>
                                        <select ng-disabled="!createMeal" class="form-control" name="spiceSelect" id="spiceSelect" ng-model="meal.spice_level">
                                            <option value="" selected >--Select Spice level--</option>
                                            <option value="Low">Low</option>
                                            <option value="Medium">Medium</option>
                                            <option value="High">High</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>Status</label>
                                        <select ng-disabled="!createMeal" class="form-control" name="spiceSelect" id="status" ng-model="meal.status">
                                            <option value="" selected >--Select Status--</option>
                                            <option value="Active">Active </option>
                                            <option value="Disabled">Disabled</option>
                                            <option value="OutOfStock">Out Of Stock</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>Cuisine <em  class="fa fa-asterisk"></em></label>
                                        <select ng-disabled="!createMeal" class="form-control" name="Cuisine" id="Cuisine" ng-model="meal.cuisine_id" required>
                                            <option value="" disabled>--Select Cuisine--</option>
                                            <option ng-selected="meal['cuisine']['id'] == cuisine.id" ng-repeat="cuisine in cuisines" value="{{cuisine.id}}">{{cuisine.name.toUpperCase()}} </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <label>Ingredients </label>
                                        <input ng-disabled="!createMeal" ng-disabled="!createMeal" type="text" minlength="5" maxlength="200" class="form-control" ng-model="meal.ingredients">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <br>
                                        <label>This Meal? </label>
                                        <div class="row">
                                            <div class="col-md-3" ng-repeat="check in mealChecks['regular']">
                                                <input ng-disabled="!createMeal" type="checkbox" ng-model="meal[check]" />
                                                <span style="font-size: 16px; color: #4f1d1e">
                                                    {{check.split('_').join(' ').toUpperCase()}}
                                                </span>
                                            </div>
                                            <div class="col-md-3" ng-repeat="check in mealChecks['veg']">
                                                <input ng-disabled="!createMeal || (meal['contains_meat'] || meal['contains_egg'])" type="checkbox" ng-model="meal[check]" />
                                                <span style="font-size: 16px; color: #4f1d1e">
                                                    {{check.split('_').join(' ').toUpperCase()}}
                                                </span>
                                            </div>
                                            <div class="col-md-3" ng-repeat="check in mealChecks['nonveg']">
                                                <input ng-disabled="!createMeal || (meal['is_veg'] || meal['is_vegan'])" type="checkbox" ng-model="meal[check]" />
                                                <span style="font-size: 16px; color: #4f1d1e">
                                                    {{check.split('_').join(' ').toUpperCase()}}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" ng-disabled="button.loading"
                                    ng-class="{loggingIn: button.loading}" class="btn btn-lg btn-success">
                                {{ button.loading? 'Saving...':  createMeal? 'Save':'Edit' }}
                            </button>
                            <button style="margin-left: 10px" ng-if="showCancelMeal" ng-click="cancelEdit()" ng-disabled="button.loading"
                                    ng-class="{loggingIn: button.loading}" class="btn btn-lg btn-warning">
                                {{ button.loading? 'Saving...': 'cancel' }}
                            </button>
                            <button style="margin-left: 10px" ng-if="!showCancelMeal && (editMeal || createMeal)" ng-click="cancelCreateMeal()" ng-disabled="button.loading"
                                    ng-class="{loggingIn: button.loading}" class="btn btn-lg btn-warning">
                                {{ button.loading? 'Saving...': 'cancel' }}
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div ng-if="!createMeal && !editMeal" class="row customer-page-row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <div class="dataTable_wrapper table-responsive">
                                <table class="table table-striped table-hover" id="dataTables-example">
                                    <thead>
                                    <tr class="row_heading">
                                        <th>
                                            Name
                                        </th>
                                        <th>Price</th>
                                        <th>Course</th>
                                        <th>Details</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody ng-if="noRecord">
                                    <tr>
                                        <td colspan="5">{{noRecord}}</td>
                                    </tr>
                                    </tbody>
                                    <tbody ng-if="!noRecord">
                                    <tr class="gradeA" ng-repeat="meal in meals" style="cursor: pointer">
                                        <td ng-click="editMealDetails(meal)">Name: <strong>{{meal.name}}</strong><br>
                                            About: {{meal.description}}<br>
                                            <span ng-if="meal.ingredients">Ingredients: {{meal.ingredients}}</span>
                                        </td>
                                        <td ng-click="editMealDetails(meal)">{{meal.price}}</td>
                                        <td ng-click="editMealDetails(meal)">{{meal.course}}</td>
                                        <td ng-click="editMealDetails(meal)">
                                            <span><strong>{{meal.cuisine["name"] | uppercase}}</strong></span><br>
                                            <span ng-if="meal['is_chef_special']"><strong>Chef Special Meal</strong><br></span>
                                            <span ng-repeat="check in mealChecks['veg']" ng-if="meal[check]">
                                                <strong style="color: green">Veg Meal ({{check.split('_').join(' ').toUpperCase()}})</strong>
                                            </span>
                                            <span ng-repeat="check in mealChecks['nonveg']" ng-if="meal[check]">
                                                <strong style="color: red">Non-Veg Meal ({{check.split('_').join(' ').toUpperCase()}})</strong>
                                            </span>
                                        </td>
                                        <td ng-click="editMealDetails(meal)">{{meal.status}}</td>
                                        <td>
                                            <p>Status: {{meal.setStatus ? 'In Stock' : 'Out Of Stock'}}</p>
                                            <toggle-switch
                                                    ng-model="meal.setStatus"
                                                    on-label="In Stock"
                                                    knob-label="Status"
                                                    class="switch-success"
                                                    ng-confirm-click="Are you sure you want to show this meal {{!meal.setStatus ? 'In Stock' : 'Out Of Stock'}}?"
                                                    ng-change="changeStatus(meal)"
                                                    off-label="Out Of Stock">
                                            </toggle-switch>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
            </div>
        </div>
    </div>
</div>

